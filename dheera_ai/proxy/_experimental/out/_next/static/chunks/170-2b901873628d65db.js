"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[170],{1309:function(e,a,l){l.d(a,{C:function(){return r.Z}});var r=l(41649)},60170:function(e,a,l){l.d(a,{Z:function(){return aA}});var r,t,i,s,n=l(57437),d=l(2265),o=l(78489),c=l(12485),u=l(18135),m=l(35242),x=l(29706),h=l(77991),p=l(19250),g=l(57840),f=l(37592),j=l(15690),v=l(10032),_=l(3810),y=l(22116),b=l(64504);(r=i||(i={})).PresidioPII="Presidio PII",r.Bedrock="Bedrock Guardrail",r.Lakera="Lakera";let N={},w=e=>{let a={};return a.PresidioPII="Presidio PII",a.Bedrock="Bedrock Guardrail",a.Lakera="Lakera",Object.entries(e).forEach(e=>{let[l,r]=e;r&&"object"==typeof r&&"ui_friendly_name"in r&&(a[l.split("_").map((e,a)=>e.charAt(0).toUpperCase()+e.slice(1)).join("")]=r.ui_friendly_name)}),N=a,a},k=()=>Object.keys(N).length>0?N:i,C={PresidioPII:"presidio",Bedrock:"bedrock",Lakera:"lakera_v2",LitellmContentFilter:"dheera_ai_content_filter",ToolPermission:"tool_permission"},S=e=>{Object.entries(e).forEach(e=>{let[a,l]=e;l&&"object"==typeof l&&"ui_friendly_name"in l&&(C[a.split("_").map((e,a)=>e.charAt(0).toUpperCase()+e.slice(1)).join("")]=a)})},Z=e=>!!e&&"Presidio PII"===k()[e],P=e=>!!e&&"DheeraAI Content Filter"===k()[e],O="../ui/assets/logos/",I={"Presidio PII":"".concat(O,"presidio.png"),"Bedrock Guardrail":"".concat(O,"bedrock.svg"),Lakera:"".concat(O,"lakeraai.jpeg"),"Azure Content Safety Prompt Shield":"".concat(O,"presidio.png"),"Azure Content Safety Text Moderation":"".concat(O,"presidio.png"),"Aporia AI":"".concat(O,"aporia.png"),"PANW Prisma AIRS":"".concat(O,"palo_alto_networks.jpeg"),"Noma Security":"".concat(O,"noma_security.png"),"Javelin Guardrails":"".concat(O,"javelin.png"),"Pillar Guardrail":"".concat(O,"pillar.jpeg"),"Google Cloud Model Armor":"".concat(O,"google.svg"),"Guardrails AI":"".concat(O,"guardrails_ai.jpeg"),"Lasso Guardrail":"".concat(O,"lasso.png"),"Pangea Guardrail":"".concat(O,"pangea.png"),"AIM Guardrail":"".concat(O,"aim_security.jpeg"),"OpenAI Moderation":"".concat(O,"openai_small.svg"),EnkryptAI:"".concat(O,"enkrypt_ai.avif"),"Prompt Security":"".concat(O,"prompt_security.png"),"DheeraAI Content Filter":"".concat(O,"dheera_ai_logo.jpg")},A=e=>{if(!e)return{logo:"",displayName:"-"};let a=Object.keys(C).find(a=>C[a].toLowerCase()===e.toLowerCase());if(!a)return{logo:"",displayName:e};let l=k()[a];return{logo:I[l]||"",displayName:l||e}};var L=l(99981),E=l(5545),T=l(61994),z=l(97416),B=l(8881),G=l(10798),F=l(49638);let{Text:D}=g.default,{Option:K}=f.default,M=e=>e.replace(/_/g," "),R=e=>{switch(e){case"MASK":return(0,n.jsx)(z.Z,{style:{marginRight:4}});case"BLOCK":return(0,n.jsx)(B.Z,{style:{marginRight:4}});default:return null}},J=e=>{let{categories:a,selectedCategories:l,onChange:r}=e;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)(G.Z,{className:"text-gray-500 mr-1"}),(0,n.jsx)(D,{className:"text-gray-500 font-medium",children:"Filter by category"})]}),(0,n.jsx)(f.default,{mode:"multiple",placeholder:"Select categories to filter by",style:{width:"100%"},onChange:r,value:l,allowClear:!0,showSearch:!0,optionFilterProp:"children",className:"mb-4",tagRender:e=>(0,n.jsx)(_.Z,{color:"blue",closable:e.closable,onClose:e.onClose,className:"mr-2 mb-2",children:e.label}),children:a.map(e=>(0,n.jsx)(K,{value:e.category,children:e.category},e.category))})]})},V=e=>{let{onSelectAll:a,onUnselectAll:l,hasSelectedEntities:r}=e;return(0,n.jsxs)("div",{className:"bg-gray-50 p-5 rounded-lg mb-6 border border-gray-200 shadow-sm",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(D,{strong:!0,className:"text-gray-700 text-base",children:"Quick Actions"}),(0,n.jsx)(L.Z,{title:"Apply action to all PII types at once",children:(0,n.jsx)("div",{className:"ml-2 text-gray-400 cursor-help text-xs",children:"â“˜"})})]}),(0,n.jsx)(E.ZP,{color:"danger",variant:"outlined",onClick:l,disabled:!r,icon:(0,n.jsx)(F.Z,{}),children:"Unselect All"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsx)(E.ZP,{color:"primary",variant:"outlined",onClick:()=>a("MASK"),className:"h-10",block:!0,icon:(0,n.jsx)(z.Z,{}),children:"Select All & Mask"}),(0,n.jsx)(E.ZP,{color:"danger",variant:"outlined",onClick:()=>a("BLOCK"),className:"h-10 hover:bg-red-100",block:!0,icon:(0,n.jsx)(B.Z,{}),children:"Select All & Block"})]})]})},U=e=>{let{entities:a,selectedEntities:l,selectedActions:r,actions:t,onEntitySelect:i,onActionSelect:s,entityToCategoryMap:d}=e;return(0,n.jsxs)("div",{className:"border rounded-lg overflow-hidden shadow-sm",children:[(0,n.jsxs)("div",{className:"bg-gray-50 px-5 py-3 border-b flex",children:[(0,n.jsx)(D,{strong:!0,className:"flex-1 text-gray-700",children:"PII Type"}),(0,n.jsx)(D,{strong:!0,className:"w-32 text-right text-gray-700",children:"Action"})]}),(0,n.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:0===a.length?(0,n.jsx)("div",{className:"py-10 text-center text-gray-500",children:"No PII types match your filter criteria"}):a.map(e=>(0,n.jsxs)("div",{className:"px-5 py-3 flex items-center justify-between hover:bg-gray-50 border-b ".concat(l.includes(e)?"bg-blue-50":""),children:[(0,n.jsxs)("div",{className:"flex items-center flex-1",children:[(0,n.jsx)(T.Z,{checked:l.includes(e),onChange:()=>i(e),className:"mr-3"}),(0,n.jsx)(D,{className:l.includes(e)?"font-medium text-gray-900":"text-gray-700",children:M(e)}),d.get(e)&&(0,n.jsx)(_.Z,{className:"ml-2 text-xs",color:"blue",children:d.get(e)})]}),(0,n.jsx)("div",{className:"w-32",children:(0,n.jsx)(f.default,{value:l.includes(e)&&r[e]||"MASK",onChange:a=>s(e,a),style:{width:120},disabled:!l.includes(e),className:"".concat(l.includes(e)?"":"opacity-50"),dropdownMatchSelectWidth:!1,children:t.map(e=>(0,n.jsx)(K,{value:e,children:(0,n.jsxs)("div",{className:"flex items-center",children:[R(e),e]})},e))})})]},e))})]})},{Title:q,Text:W}=g.default;var Y=e=>{let{entities:a,actions:l,selectedEntities:r,selectedActions:t,onEntitySelect:i,onActionSelect:s,entityCategories:o=[]}=e,[c,u]=(0,d.useState)([]),m=new Map;o.forEach(e=>{e.entities.forEach(a=>{m.set(a,e.category)})});let x=a.filter(e=>0===c.length||c.includes(m.get(e)||""));return(0,n.jsxs)("div",{className:"pii-configuration",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-5",children:[(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)(q,{level:4,className:"!m-0 font-semibold text-gray-800",children:"Configure PII Protection"})}),(0,n.jsxs)(W,{className:"text-gray-500",children:[r.length," items selected"]})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)(J,{categories:o,selectedCategories:c,onChange:u}),(0,n.jsx)(V,{onSelectAll:e=>{a.forEach(a=>{r.includes(a)||i(a),s(a,e)})},onUnselectAll:()=>{r.forEach(e=>{i(e)})},hasSelectedEntities:r.length>0})]}),(0,n.jsx)(U,{entities:x,selectedEntities:r,selectedActions:t,actions:l,onEntitySelect:i,onActionSelect:s,entityToCategoryMap:m})]})},H=l(10353),$=l(31283),Q=l(24199),X=e=>{var a;let{selectedProvider:l,accessToken:r,providerParams:t=null,value:i=null}=e,[s,o]=(0,d.useState)(!1),[c,u]=(0,d.useState)(t),[m,x]=(0,d.useState)(null);if((0,d.useEffect)(()=>{if(t){u(t);return}let e=async()=>{if(r){o(!0),x(null);try{let e=await (0,p.getGuardrailProviderSpecificParams)(r);console.log("Provider params API response:",e),u(e),w(e),S(e)}catch(e){console.error("Error fetching provider params:",e),x("Failed to load provider parameters")}finally{o(!1)}}};t||e()},[r,t]),!l)return null;if(s)return(0,n.jsx)(H.Z,{tip:"Loading provider parameters..."});if(m)return(0,n.jsx)("div",{className:"text-red-500",children:m});let h=null===(a=C[l])||void 0===a?void 0:a.toLowerCase(),g=c&&c[h];if(console.log("Provider key:",h),console.log("Provider fields:",g),!g||0===Object.keys(g).length)return(0,n.jsx)("div",{children:"No configuration fields available for this provider."});console.log("Value:",i);let j=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2?arguments[2]:void 0;return Object.entries(e).map(e=>{let[r,t]=e,s=a?"".concat(a,".").concat(r):r,d=l?l[r]:null==i?void 0:i[r];return(console.log("Field value:",d),"ui_friendly_name"===r||"optional_params"===r&&"nested"===t.type&&t.fields)?null:"nested"===t.type&&t.fields?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"mb-2 font-medium",children:r}),(0,n.jsx)("div",{className:"ml-4 border-l-2 border-gray-200 pl-4",children:j(t.fields,s,d)})]},s):(0,n.jsx)(v.Z.Item,{name:s,label:r,tooltip:t.description,rules:t.required?[{required:!0,message:"".concat(r," is required")}]:void 0,children:"select"===t.type&&t.options?(0,n.jsx)(f.default,{placeholder:t.description,defaultValue:d||t.default_value,children:t.options.map(e=>(0,n.jsx)(f.default.Option,{value:e,children:e},e))}):"multiselect"===t.type&&t.options?(0,n.jsx)(f.default,{mode:"multiple",placeholder:t.description,defaultValue:d||t.default_value,children:t.options.map(e=>(0,n.jsx)(f.default.Option,{value:e,children:e},e))}):"bool"===t.type||"boolean"===t.type?(0,n.jsxs)(f.default,{placeholder:t.description,defaultValue:void 0!==d?String(d):t.default_value,children:[(0,n.jsx)(f.default.Option,{value:"true",children:"True"}),(0,n.jsx)(f.default.Option,{value:"false",children:"False"})]}):"number"===t.type?(0,n.jsx)(Q.Z,{step:1,width:400,placeholder:t.description,defaultValue:void 0!==d?Number(d):void 0}):r.includes("password")||r.includes("secret")||r.includes("key")?(0,n.jsx)($.o,{placeholder:t.description,type:"password",defaultValue:d||""}):(0,n.jsx)($.o,{placeholder:t.description,type:"text",defaultValue:d||""})},s)})};return(0,n.jsx)(n.Fragment,{children:j(g)})};let{Title:ee}=g.default,ea=e=>{let{field:a,fieldKey:l,fullFieldKey:r,value:t}=e,[i,s]=d.useState([]),[o,c]=d.useState(a.dict_key_options||[]);d.useEffect(()=>{if(t&&"object"==typeof t){let e=Object.keys(t);s(e.map(e=>({key:e,id:"".concat(e,"_").concat(Date.now(),"_").concat(Math.random())}))),c((a.dict_key_options||[]).filter(a=>!e.includes(a)))}},[t,a.dict_key_options]);let u=e=>{e&&(s([...i,{key:e,id:"".concat(e,"_").concat(Date.now())}]),c(o.filter(a=>a!==e)))},m=(e,a)=>{s(i.filter(a=>a.id!==e)),c([...o,a].sort())};return(0,n.jsxs)("div",{className:"space-y-3",children:[i.map(e=>(0,n.jsxs)("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[(0,n.jsx)("div",{className:"w-24 font-medium text-sm",children:e.key}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(v.Z.Item,{name:Array.isArray(r)?[...r,e.key]:[r,e.key],style:{marginBottom:0},initialValue:t&&"object"==typeof t?t[e.key]:void 0,normalize:"number"===a.dict_value_type?e=>{if(null==e||""===e)return;let a=Number(e);return isNaN(a)?e:a}:void 0,children:"number"===a.dict_value_type?(0,n.jsx)(Q.Z,{step:1,width:200,placeholder:"Enter ".concat(e.key," value")}):"boolean"===a.dict_value_type?(0,n.jsxs)(f.default,{placeholder:"Select ".concat(e.key," value"),children:[(0,n.jsx)(f.default.Option,{value:!0,children:"True"}),(0,n.jsx)(f.default.Option,{value:!1,children:"False"})]}):(0,n.jsx)($.o,{placeholder:"Enter ".concat(e.key," value"),type:"text"})})}),(0,n.jsx)("button",{type:"button",className:"text-red-500 hover:text-red-700 text-sm",onClick:()=>m(e.id,e.key),children:"Remove"})]},e.id)),o.length>0&&(0,n.jsxs)("div",{className:"flex items-center space-x-3 mt-2",children:[(0,n.jsx)(f.default,{placeholder:"Select category to configure",style:{width:200},onSelect:e=>e&&u(e),value:void 0,children:o.map(e=>(0,n.jsx)(f.default.Option,{value:e,children:e},e))}),(0,n.jsx)("span",{className:"text-sm text-gray-500",children:"Select a category to add threshold configuration"})]})]})};var el=e=>{let{optionalParams:a,parentFieldKey:l,values:r}=e,t=(e,a)=>{let t="".concat(l,".").concat(e),i=null==r?void 0:r[e];return(console.log("value",i),"dict"===a.type&&a.dict_key_options)?(0,n.jsxs)("div",{className:"mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200",children:[(0,n.jsx)("div",{className:"mb-4 font-medium text-gray-900 text-base",children:e}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:a.description}),(0,n.jsx)(ea,{field:a,fieldKey:e,fullFieldKey:[l,e],value:i})]},t):(0,n.jsx)("div",{className:"mb-8 p-6 bg-white rounded-lg border border-gray-200 shadow-sm",children:(0,n.jsx)(v.Z.Item,{name:[l,e],label:(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)("div",{className:"font-medium text-gray-900 text-base",children:e}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:a.description})]}),rules:a.required?[{required:!0,message:"".concat(e," is required")}]:void 0,className:"mb-0",initialValue:void 0!==i?i:a.default_value,normalize:"number"===a.type?e=>{if(null==e||""===e)return;let a=Number(e);return isNaN(a)?e:a}:void 0,children:"select"===a.type&&a.options?(0,n.jsx)(f.default,{placeholder:a.description,children:a.options.map(e=>(0,n.jsx)(f.default.Option,{value:e,children:e},e))}):"multiselect"===a.type&&a.options?(0,n.jsx)(f.default,{mode:"multiple",placeholder:a.description,children:a.options.map(e=>(0,n.jsx)(f.default.Option,{value:e,children:e},e))}):"bool"===a.type||"boolean"===a.type?(0,n.jsxs)(f.default,{placeholder:a.description,children:[(0,n.jsx)(f.default.Option,{value:"true",children:"True"}),(0,n.jsx)(f.default.Option,{value:"false",children:"False"})]}):"number"===a.type?(0,n.jsx)(Q.Z,{step:1,width:400,placeholder:a.description}):e.includes("password")||e.includes("secret")||e.includes("key")?(0,n.jsx)($.o,{placeholder:a.description,type:"password"}):(0,n.jsx)($.o,{placeholder:a.description,type:"text"})})},t)};return a.fields&&0!==Object.keys(a.fields).length?(0,n.jsxs)("div",{className:"guardrail-optional-params",children:[(0,n.jsxs)("div",{className:"mb-8 pb-4 border-b border-gray-100",children:[(0,n.jsx)(ee,{level:3,className:"mb-2 font-semibold text-gray-900",children:"Optional Parameters"}),(0,n.jsx)("p",{className:"text-gray-600 text-sm",children:a.description||"Configure additional settings for this guardrail provider"})]}),(0,n.jsx)("div",{className:"space-y-8",children:Object.entries(a.fields).map(e=>{let[a,l]=e;return t(a,l)})})]}):null},er=l(9114),et=l(5945),ei=l(58760),es=l(65319),en=l(96473),ed=l(3632),eo=l(16312);let{Text:ec}=g.default,{Option:eu}=f.default;var em=e=>{let{visible:a,prebuiltPatterns:l,categories:r,selectedPatternName:t,patternAction:i,onPatternNameChange:s,onActionChange:d,onAdd:o,onCancel:c}=e;return(0,n.jsxs)(y.Z,{title:"Add prebuilt pattern",open:a,onCancel:c,footer:null,width:800,children:[(0,n.jsxs)(ei.Z,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(ec,{strong:!0,children:"Pattern type"}),(0,n.jsx)(f.default,{placeholder:"Choose pattern type",value:t,onChange:s,style:{width:"100%",marginTop:8},showSearch:!0,filterOption:(e,a)=>{let r=l.find(e=>e.name===(null==a?void 0:a.value));return!!r&&(r.display_name.toLowerCase().includes(e.toLowerCase())||r.name.toLowerCase().includes(e.toLowerCase()))},children:r.map(e=>{let a=l.filter(a=>a.category===e);return 0===a.length?null:(0,n.jsx)(f.default.OptGroup,{label:e,children:a.map(e=>(0,n.jsx)(eu,{value:e.name,children:e.display_name},e.name))},e)})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ec,{strong:!0,children:"Action"}),(0,n.jsx)(ec,{type:"secondary",style:{display:"block",marginTop:4,marginBottom:8},children:"Choose what action the guardrail should take when this pattern is detected"}),(0,n.jsxs)(f.default,{value:i,onChange:d,style:{width:"100%"},children:[(0,n.jsx)(eu,{value:"BLOCK",children:"Block"}),(0,n.jsx)(eu,{value:"MASK",children:"Mask"})]})]})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[(0,n.jsx)(eo.z,{variant:"secondary",onClick:c,children:"Cancel"}),(0,n.jsx)(eo.z,{onClick:o,children:"Add"})]})]})};let{Text:ex}=g.default,{Option:eh}=f.default;var ep=e=>{let{visible:a,patternName:l,patternRegex:r,patternAction:t,onNameChange:i,onRegexChange:s,onActionChange:d,onAdd:o,onCancel:c}=e;return(0,n.jsxs)(y.Z,{title:"Add custom regex pattern",open:a,onCancel:c,footer:null,width:800,children:[(0,n.jsxs)(ei.Z,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(ex,{strong:!0,children:"Pattern name"}),(0,n.jsx)(b.o,{placeholder:"e.g., internal_id, employee_code",value:l,onValueChange:i,style:{marginTop:8}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ex,{strong:!0,children:"Regex pattern"}),(0,n.jsx)(b.o,{placeholder:"e.g., ID-[0-9]{6}",value:r,onValueChange:s,style:{marginTop:8}}),(0,n.jsx)(ex,{type:"secondary",style:{fontSize:12},children:"Enter a valid regular expression to match sensitive data"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ex,{strong:!0,children:"Action"}),(0,n.jsx)(ex,{type:"secondary",style:{display:"block",marginTop:4,marginBottom:8},children:"Choose what action the guardrail should take when this pattern is detected"}),(0,n.jsxs)(f.default,{value:t,onChange:d,style:{width:"100%"},children:[(0,n.jsx)(eh,{value:"BLOCK",children:"Block"}),(0,n.jsx)(eh,{value:"MASK",children:"Mask"})]})]})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[(0,n.jsx)(b.z,{variant:"secondary",onClick:c,children:"Cancel"}),(0,n.jsx)(b.z,{onClick:o,children:"Add"})]})]})},eg=l(49566),ef=l(16853);let{Text:ej}=g.default,{Option:ev}=f.default;var e_=e=>{let{visible:a,keyword:l,action:r,description:t,onKeywordChange:i,onActionChange:s,onDescriptionChange:d,onAdd:c,onCancel:u}=e;return(0,n.jsxs)(y.Z,{title:"Add blocked keyword",open:a,onCancel:u,footer:null,width:800,children:[(0,n.jsxs)(ei.Z,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(ej,{strong:!0,children:"Keyword"}),(0,n.jsx)(eg.Z,{placeholder:"Enter sensitive keyword or phrase",value:l,onValueChange:i,style:{marginTop:8}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ej,{strong:!0,children:"Action"}),(0,n.jsx)(ej,{type:"secondary",style:{display:"block",marginTop:4,marginBottom:8},children:"Choose what action the guardrail should take when this keyword is detected"}),(0,n.jsxs)(f.default,{value:r,onChange:s,style:{width:"100%"},children:[(0,n.jsx)(ev,{value:"BLOCK",children:"Block"}),(0,n.jsx)(ev,{value:"MASK",children:"Mask"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ej,{strong:!0,children:"Description (optional)"}),(0,n.jsx)(ef.Z,{placeholder:"Explain why this keyword is sensitive",value:t,onValueChange:d,rows:3,style:{marginTop:8}})]})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[(0,n.jsx)(o.Z,{variant:"secondary",onClick:u,children:"Cancel"}),(0,n.jsx)(o.Z,{onClick:c,children:"Add"})]})]})},ey=l(56609),eb=l(26349);let{Text:eN}=g.default,{Option:ew}=f.default;var ek=e=>{let{patterns:a,onActionChange:l,onRemove:r}=e,t=[{title:"Type",dataIndex:"type",key:"type",width:100,render:e=>(0,n.jsx)(_.Z,{color:"prebuilt"===e?"blue":"green",children:"prebuilt"===e?"Prebuilt":"Custom"})},{title:"Pattern name",dataIndex:"name",key:"name",render:(e,a)=>a.display_name||a.name},{title:"Regex pattern",dataIndex:"pattern",key:"pattern",render:e=>e?(0,n.jsxs)(eN,{code:!0,style:{fontSize:12},children:[e.substring(0,40),"..."]}):"-"},{title:"Action",dataIndex:"action",key:"action",width:150,render:(e,a)=>(0,n.jsxs)(f.default,{value:e,onChange:e=>l(a.id,e),style:{width:120},size:"small",children:[(0,n.jsx)(ew,{value:"BLOCK",children:"Block"}),(0,n.jsx)(ew,{value:"MASK",children:"Mask"})]})},{title:"",key:"actions",width:100,render:(e,a)=>(0,n.jsx)(eo.z,{type:"button",variant:"light",color:"red",size:"xs",icon:eb.Z,onClick:()=>r(a.id),children:"Delete"})}];return 0===a.length?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:"No patterns added."}):(0,n.jsx)(ey.Z,{dataSource:a,columns:t,rowKey:"id",pagination:!1,size:"small"})};let{Text:eC}=g.default,{Option:eS}=f.default;var eZ=e=>{let{keywords:a,onActionChange:l,onRemove:r}=e,t=[{title:"Keyword",dataIndex:"keyword",key:"keyword"},{title:"Action",dataIndex:"action",key:"action",width:150,render:(e,a)=>(0,n.jsxs)(f.default,{value:e,onChange:e=>l(a.id,"action",e),style:{width:120},size:"small",children:[(0,n.jsx)(eS,{value:"BLOCK",children:"Block"}),(0,n.jsx)(eS,{value:"MASK",children:"Mask"})]})},{title:"Description",dataIndex:"description",key:"description",render:e=>e||"-"},{title:"",key:"actions",width:100,render:(e,a)=>(0,n.jsx)(eo.z,{type:"button",variant:"light",color:"red",size:"xs",icon:eb.Z,onClick:()=>r(a.id),children:"Delete"})}];return 0===a.length?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:"No keywords added."}):(0,n.jsx)(ey.Z,{dataSource:a,columns:t,rowKey:"id",pagination:!1,size:"small"})};let{Title:eP,Text:eO}=g.default;var eI=e=>{let{prebuiltPatterns:a,categories:l,selectedPatterns:r,blockedWords:t,onPatternAdd:i,onPatternRemove:s,onPatternActionChange:o,onBlockedWordAdd:c,onBlockedWordRemove:u,onBlockedWordUpdate:m,onFileUpload:x,accessToken:h,showStep:g}=e,[f,j]=(0,d.useState)(!1),[v,_]=(0,d.useState)(!1),[y,b]=(0,d.useState)(!1),[N,w]=(0,d.useState)(""),[k,C]=(0,d.useState)("BLOCK"),[S,Z]=(0,d.useState)(""),[P,O]=(0,d.useState)(""),[I,A]=(0,d.useState)("BLOCK"),[L,E]=(0,d.useState)(""),[T,z]=(0,d.useState)("BLOCK"),[B,G]=(0,d.useState)(""),[F,D]=(0,d.useState)(!1),K=async e=>{D(!0);try{let a=await e.text();if(h){let e=await (0,p.validateBlockedWordsFile)(h,a);if(e.valid)x&&x(a),er.Z.success(e.message||"File uploaded successfully");else{let a=e.error||e.errors&&e.errors.join(", ")||"Invalid file";er.Z.error("Validation failed: ".concat(a))}}}catch(e){er.Z.error("Failed to upload file: ".concat(e))}finally{D(!1)}return!1};return(0,n.jsxs)("div",{className:"space-y-6",children:[!g&&(0,n.jsx)("div",{children:(0,n.jsx)(eO,{type:"secondary",children:"Configure patterns and keywords to detect and filter sensitive information in requests and responses."})}),(!g||"patterns"===g)&&(0,n.jsxs)(et.Z,{title:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(eP,{level:5,style:{margin:0},children:"Pattern Detection"}),(0,n.jsx)(eO,{type:"secondary",style:{fontSize:14,fontWeight:400},children:"Detect sensitive information using regex patterns (SSN, credit cards, API keys, etc.)"})]}),size:"small",children:[(0,n.jsx)("div",{style:{marginBottom:16},children:(0,n.jsxs)(ei.Z,{children:[(0,n.jsx)(eo.z,{type:"button",onClick:()=>j(!0),icon:en.Z,children:"Add prebuilt pattern"}),(0,n.jsx)(eo.z,{type:"button",onClick:()=>b(!0),variant:"secondary",icon:en.Z,children:"Add custom regex"})]})}),(0,n.jsx)(ek,{patterns:r,onActionChange:o,onRemove:s})]}),(!g||"keywords"===g)&&(0,n.jsxs)(et.Z,{title:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(eP,{level:5,style:{margin:0},children:"Blocked Keywords"}),(0,n.jsx)(eO,{type:"secondary",style:{fontSize:14,fontWeight:400},children:"Block or mask specific sensitive terms and phrases"})]}),size:"small",children:[(0,n.jsx)("div",{style:{marginBottom:16},children:(0,n.jsxs)(ei.Z,{children:[(0,n.jsx)(eo.z,{type:"button",onClick:()=>_(!0),icon:en.Z,children:"Add keyword"}),(0,n.jsx)(es.default,{beforeUpload:K,accept:".yaml,.yml",showUploadList:!1,children:(0,n.jsx)(eo.z,{type:"button",variant:"secondary",icon:ed.Z,loading:F,children:"Upload YAML file"})})]})}),(0,n.jsx)(eZ,{keywords:t,onActionChange:m,onRemove:u})]}),(0,n.jsx)(em,{visible:f,prebuiltPatterns:a,categories:l,selectedPatternName:N,patternAction:k,onPatternNameChange:w,onActionChange:e=>C(e),onAdd:()=>{if(!N){er.Z.error("Please select a pattern");return}let e=a.find(e=>e.name===N);i({id:"pattern-".concat(Date.now()),type:"prebuilt",name:N,display_name:null==e?void 0:e.display_name,action:k}),j(!1),w(""),C("BLOCK")},onCancel:()=>{j(!1),w(""),C("BLOCK")}}),(0,n.jsx)(ep,{visible:y,patternName:S,patternRegex:P,patternAction:I,onNameChange:Z,onRegexChange:O,onActionChange:e=>A(e),onAdd:()=>{if(!S||!P){er.Z.error("Please provide pattern name and regex");return}i({id:"custom-".concat(Date.now()),type:"custom",name:S,pattern:P,action:I}),b(!1),Z(""),O(""),A("BLOCK")},onCancel:()=>{b(!1),Z(""),O(""),A("BLOCK")}}),(0,n.jsx)(e_,{visible:v,keyword:L,action:T,description:B,onKeywordChange:E,onActionChange:e=>z(e),onDescriptionChange:G,onAdd:()=>{if(!L){er.Z.error("Please enter a keyword");return}c({id:"word-".concat(Date.now()),keyword:L,action:T,description:B||void 0}),_(!1),E(""),G(""),z("BLOCK")},onCancel:()=>{_(!1),E(""),G(""),z("BLOCK")}})]})},eA=l(78801),eL=l(4260),eE=l(23496),eT=l(85180),ez=l(15424);let eB={rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""},eG=e=>({...eB,...e||{},rules:(null==e?void 0:e.rules)?[...e.rules]:[]});var eF=e=>{let{value:a,onChange:l,disabled:r=!1}=e,t=eG(a),i=e=>{let a={...t,...e};null==l||l(a)},s=(e,a)=>{i({rules:t.rules.map((l,r)=>r===e?{...l,...a}:l)})},d=e=>{i({rules:t.rules.filter((a,l)=>l!==e)})},o=(e,a)=>{let l=t.rules[e];if(!l)return;let r=Object.entries(l.allowed_param_patterns||{});a(r);let i={};r.forEach(e=>{let[a,l]=e;i[a]=l}),s(e,{allowed_param_patterns:Object.keys(i).length>0?i:void 0})},c=(e,a,l)=>{o(e,e=>{if(!e[a])return;let[,r]=e[a];e[a]=[l,r]})},u=(e,a,l)=>{o(e,e=>{if(!e[a])return;let[r]=e[a];e[a]=[r,l]})},m=(e,a)=>{let l=Object.entries(e.allowed_param_patterns||{});return 0===l.length?(0,n.jsx)(E.ZP,{disabled:r,size:"small",onClick:()=>s(a,{allowed_param_patterns:{"":""}}),children:"+ Restrict tool arguments (optional)"}):(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eA.x,{className:"text-sm text-gray-600",children:"Argument constraints (dot or array paths)"}),l.map((l,t)=>{let[i,s]=l;return(0,n.jsxs)(ei.Z,{align:"start",children:[(0,n.jsx)(eL.default,{disabled:r,placeholder:"messages[0].content",value:i,onChange:e=>c(a,t,e.target.value)}),(0,n.jsx)(eL.default,{disabled:r,placeholder:"^email@.*$",value:s,onChange:e=>u(a,t,e.target.value)}),(0,n.jsx)(E.ZP,{disabled:r,icon:(0,n.jsx)(eb.Z,{}),danger:!0,onClick:()=>o(a,e=>{e.splice(t,1)})})]},"".concat(e.id||a,"-").concat(t))}),(0,n.jsx)(E.ZP,{disabled:r,size:"small",onClick:()=>s(a,{allowed_param_patterns:{...e.allowed_param_patterns||{},"":""}}),children:"+ Add another constraint"})]})};return(0,n.jsxs)(eA.Z,{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(eA.x,{className:"text-lg font-semibold",children:"DheeraAI Tool Permission Guardrail"}),(0,n.jsx)(eA.x,{className:"text-sm text-gray-500",children:"Provide regex patterns (e.g., ^mcp__github_.*$) for tool names or types and optionally constrain payload fields."})]}),!r&&(0,n.jsx)(E.ZP,{icon:(0,n.jsx)(en.Z,{}),type:"primary",onClick:()=>{i({rules:[...t.rules,{id:"rule_".concat(Math.random().toString(36).slice(2,8)),decision:"allow",allowed_param_patterns:void 0}]})},className:"!bg-blue-600 !text-white hover:!bg-blue-500",children:"Add Rule"})]}),(0,n.jsx)(eE.Z,{}),0===t.rules.length?(0,n.jsx)(eT.Z,{description:"No tool rules added yet"}):(0,n.jsx)("div",{className:"space-y-4",children:t.rules.map((e,a)=>{var l,t;return(0,n.jsxs)(eA.Z,{className:"bg-gray-50",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)(eA.x,{className:"font-semibold",children:["Rule ",a+1]}),(0,n.jsx)(E.ZP,{icon:(0,n.jsx)(eb.Z,{}),danger:!0,type:"text",disabled:r,onClick:()=>d(a),children:"Remove"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(eA.x,{className:"text-sm font-medium",children:"Rule ID"}),(0,n.jsx)(eL.default,{disabled:r,placeholder:"unique_rule_id",value:e.id,onChange:e=>s(a,{id:e.target.value})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(eA.x,{className:"text-sm font-medium",children:"Tool Name (optional)"}),(0,n.jsx)(eL.default,{disabled:r,placeholder:"^mcp__github_.*$",value:null!==(l=e.tool_name)&&void 0!==l?l:"",onChange:e=>s(a,{tool_name:""===e.target.value.trim()?void 0:e.target.value})})]})]}),(0,n.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 mt-4",children:(0,n.jsxs)("div",{children:[(0,n.jsx)(eA.x,{className:"text-sm font-medium",children:"Tool Type (optional)"}),(0,n.jsx)(eL.default,{disabled:r,placeholder:"^function$",value:null!==(t=e.tool_type)&&void 0!==t?t:"",onChange:e=>s(a,{tool_type:""===e.target.value.trim()?void 0:e.target.value})})]})}),(0,n.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,n.jsx)(eA.x,{className:"text-sm font-medium",children:"Decision"}),(0,n.jsxs)(f.default,{disabled:r,value:e.decision,style:{width:200},onChange:e=>s(a,{decision:e}),children:[(0,n.jsx)(f.default.Option,{value:"allow",children:"Allow"}),(0,n.jsx)(f.default.Option,{value:"deny",children:"Deny"})]})]}),(0,n.jsx)("div",{className:"mt-4",children:m(e,a)})]},e.id||a)})}),(0,n.jsx)(eE.Z,{}),(0,n.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(eA.x,{className:"text-sm font-medium",children:"Default action"}),(0,n.jsxs)(f.default,{disabled:r,value:t.default_action,onChange:e=>i({default_action:e}),children:[(0,n.jsx)(f.default.Option,{value:"allow",children:"Allow"}),(0,n.jsx)(f.default.Option,{value:"deny",children:"Deny"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)(eA.x,{className:"text-sm font-medium flex items-center gap-1",children:["On disallowed action",(0,n.jsx)(L.Z,{title:"Block returns an error when a forbidden tool is invoked. Rewrite strips the tool call but lets the rest of the response continue.",children:(0,n.jsx)(ez.Z,{})})]}),(0,n.jsxs)(f.default,{disabled:r,value:t.on_disallowed_action,onChange:e=>i({on_disallowed_action:e}),children:[(0,n.jsx)(f.default.Option,{value:"block",children:"Block"}),(0,n.jsx)(f.default.Option,{value:"rewrite",children:"Rewrite"})]})]})]}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)(eA.x,{className:"text-sm font-medium",children:"Violation message (optional)"}),(0,n.jsx)(eL.default.TextArea,{disabled:r,rows:3,placeholder:"This violates our org policy...",value:t.violation_message_template,onChange:e=>i({violation_message_template:e.target.value})})]})]})};let{Title:eD,Text:eK,Link:eM}=g.default,{Option:eR}=f.default,{Step:eJ}=j.default,eV={pre_call:"Before LLM Call - Runs before the LLM call and checks the input (Recommended)",during_call:"During LLM Call - Runs in parallel with the LLM call, with response held until check completes",post_call:"After LLM Call - Runs after the LLM call and checks only the output",logging_only:"Logging Only - Only runs on logging callbacks without affecting the LLM call",pre_mcp_call:"Before MCP Tool Call - Runs before MCP tool execution and validates tool calls",during_mcp_call:"During MCP Tool Call - Runs in parallel with MCP tool execution for monitoring"};var eU=e=>{let{visible:a,onClose:l,accessToken:r,onSuccess:t}=e,[i]=v.Z.useForm(),[s,o]=(0,d.useState)(!1),[c,u]=(0,d.useState)(null),[m,x]=(0,d.useState)(null),[h,g]=(0,d.useState)([]),[N,O]=(0,d.useState)({}),[A,L]=(0,d.useState)(0),[E,T]=(0,d.useState)(null),[z,B]=(0,d.useState)([]),[G,F]=(0,d.useState)(2),[D,K]=(0,d.useState)({}),[M,R]=(0,d.useState)([]),[J,V]=(0,d.useState)([]),[U,q]=(0,d.useState)({rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""}),W=(0,d.useMemo)(()=>!!c&&"tool_permission"===(C[c]||"").toLowerCase(),[c]);(0,d.useEffect)(()=>{r&&(async()=>{try{let[e,a]=await Promise.all([(0,p.getGuardrailUISettings)(r),(0,p.getGuardrailProviderSpecificParams)(r)]);x(e),T(a),w(a),S(a)}catch(e){console.error("Error fetching guardrail data:",e),er.Z.fromBackend("Failed to load guardrail configuration")}})()},[r]);let H=e=>{u(e),i.setFieldsValue({config:void 0,presidio_analyzer_api_base:void 0,presidio_anonymizer_api_base:void 0}),g([]),O({}),B([]),F(2),K({}),q({rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""})},$=e=>{g(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},Q=(e,a)=>{O(l=>({...l,[e]:a}))},ee=async()=>{try{if(0===A&&(await i.validateFields(["guardrail_name","provider","mode","default_on"]),c)){let e=["guardrail_name","provider","mode","default_on"];"PresidioPII"===c&&e.push("presidio_analyzer_api_base","presidio_anonymizer_api_base"),await i.validateFields(e)}if(1===A&&Z(c)&&0===h.length){er.Z.fromBackend("Please select at least one PII entity to continue");return}L(A+1)}catch(e){console.error("Form validation failed:",e)}},ea=()=>{L(A-1)},et=()=>{i.resetFields(),u(null),g([]),O({}),B([]),F(2),K({}),R([]),V([]),q({rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""}),L(0)},ei=()=>{et(),l()},es=async()=>{try{o(!0),await i.validateFields();let a=i.getFieldsValue(!0),s=C[a.provider],n={guardrail_name:a.guardrail_name,dheera_ai_params:{guardrail:s,mode:a.mode,default_on:a.default_on},guardrail_info:{}};if("PresidioPII"===a.provider&&h.length>0){let e={};h.forEach(a=>{e[a]=N[a]||"MASK"}),n.dheera_ai_params.pii_entities_config=e,a.presidio_analyzer_api_base&&(n.dheera_ai_params.presidio_analyzer_api_base=a.presidio_analyzer_api_base),a.presidio_anonymizer_api_base&&(n.dheera_ai_params.presidio_anonymizer_api_base=a.presidio_anonymizer_api_base)}if(P(a.provider))M.length>0&&(n.dheera_ai_params.patterns=M.map(e=>({pattern_type:"prebuilt"===e.type?"prebuilt":"regex",pattern_name:"prebuilt"===e.type?e.name:void 0,pattern:"custom"===e.type?e.pattern:void 0,name:e.name,action:e.action}))),J.length>0&&(n.dheera_ai_params.blocked_words=J.map(e=>({keyword:e.keyword,action:e.action,description:e.description})));else if(a.config)try{let e=JSON.parse(a.config);n.guardrail_info=e}catch(e){er.Z.fromBackend("Invalid JSON in configuration"),o(!1);return}if("tool_permission"===s){if(0===U.rules.length){er.Z.fromBackend("Add at least one tool permission rule"),o(!1);return}n.dheera_ai_params.rules=U.rules,n.dheera_ai_params.default_action=U.default_action,n.dheera_ai_params.on_disallowed_action=U.on_disallowed_action,U.violation_message_template&&(n.dheera_ai_params.violation_message_template=U.violation_message_template)}if(console.log("values: ",JSON.stringify(a)),E&&c){var e;let l=null===(e=C[c])||void 0===e?void 0:e.toLowerCase();console.log("providerKey: ",l);let r=E[l]||{},t=new Set;console.log("providerSpecificParams: ",JSON.stringify(r)),Object.keys(r).forEach(e=>{"optional_params"!==e&&t.add(e)}),r.optional_params&&r.optional_params.fields&&Object.keys(r.optional_params.fields).forEach(e=>{t.add(e)}),console.log("allowedParams: ",t),t.forEach(e=>{let l=a[e];if(null==l||""===l){var r;l=null===(r=a.optional_params)||void 0===r?void 0:r[e]}null!=l&&""!==l&&(n.dheera_ai_params[e]=l)})}if(!r)throw Error("No access token available");console.log("Sending guardrail data:",JSON.stringify(n)),await (0,p.createGuardrailCall)(r,n),er.Z.success("Guardrail created successfully"),et(),t(),l()}catch(e){console.error("Failed to create guardrail:",e),er.Z.fromBackend("Failed to create guardrail: "+(e instanceof Error?e.message:String(e)))}finally{o(!1)}},en=()=>{var e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.Z.Item,{name:"guardrail_name",label:"Guardrail Name",rules:[{required:!0,message:"Please enter a guardrail name"}],children:(0,n.jsx)(b.o,{placeholder:"Enter a name for this guardrail"})}),(0,n.jsx)(v.Z.Item,{name:"provider",label:"Guardrail Provider",rules:[{required:!0,message:"Please select a provider"}],children:(0,n.jsx)(f.default,{placeholder:"Select a guardrail provider",onChange:H,labelInValue:!1,optionLabelProp:"label",dropdownRender:e=>e,showSearch:!0,children:Object.entries(k()).map(e=>{let[a,l]=e;return(0,n.jsx)(eR,{value:a,label:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[I[l]&&(0,n.jsx)("img",{src:I[l],alt:"",style:{height:"20px",width:"20px",marginRight:"8px",objectFit:"contain"},onError:e=>{e.currentTarget.style.display="none"}}),(0,n.jsx)("span",{children:l})]}),children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[I[l]&&(0,n.jsx)("img",{src:I[l],alt:"",style:{height:"20px",width:"20px",marginRight:"8px",objectFit:"contain"},onError:e=>{e.currentTarget.style.display="none"}}),(0,n.jsx)("span",{children:l})]})},a)})})}),(0,n.jsx)(v.Z.Item,{name:"mode",label:"Mode",tooltip:"How the guardrail should be applied",rules:[{required:!0,message:"Please select a mode"}],children:(0,n.jsx)(f.default,{optionLabelProp:"label",mode:"multiple",children:(null==m?void 0:null===(e=m.supported_modes)||void 0===e?void 0:e.map(e=>(0,n.jsx)(eR,{value:e,label:e,children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:e}),"pre_call"===e&&(0,n.jsx)(_.Z,{color:"green",style:{marginLeft:"8px"},children:"Recommended"})]}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eV[e]})]})},e)))||(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eR,{value:"pre_call",label:"pre_call",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"pre_call"})," ",(0,n.jsx)(_.Z,{color:"green",children:"Recommended"})]}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eV.pre_call})]})}),(0,n.jsx)(eR,{value:"during_call",label:"during_call",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:(0,n.jsx)("strong",{children:"during_call"})}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eV.during_call})]})}),(0,n.jsx)(eR,{value:"post_call",label:"post_call",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:(0,n.jsx)("strong",{children:"post_call"})}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eV.post_call})]})}),(0,n.jsx)(eR,{value:"logging_only",label:"logging_only",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:(0,n.jsx)("strong",{children:"logging_only"})}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eV.logging_only})]})})]})})}),(0,n.jsx)(v.Z.Item,{name:"default_on",label:"Always On",tooltip:"If enabled, this guardrail will be applied to all requests by default.",children:(0,n.jsxs)(f.default,{children:[(0,n.jsx)(f.default.Option,{value:!0,children:"Yes"}),(0,n.jsx)(f.default.Option,{value:!1,children:"No"})]})}),!W&&(0,n.jsx)(X,{selectedProvider:c,accessToken:r,providerParams:E})]})},ed=()=>m&&"PresidioPII"===c?(0,n.jsx)(Y,{entities:m.supported_entities,actions:m.supported_actions,selectedEntities:h,selectedActions:N,onEntitySelect:$,onActionSelect:Q,entityCategories:m.pii_entity_categories}):null,eo=e=>{if(!m||!P(c))return null;let a=m.content_filter_settings;return a?(0,n.jsx)(eI,{prebuiltPatterns:a.prebuilt_patterns||[],categories:a.pattern_categories||[],selectedPatterns:M,blockedWords:J,onPatternAdd:e=>R([...M,e]),onPatternRemove:e=>R(M.filter(a=>a.id!==e)),onPatternActionChange:(e,a)=>{R(M.map(l=>l.id===e?{...l,action:a}:l))},onBlockedWordAdd:e=>V([...J,e]),onBlockedWordRemove:e=>V(J.filter(a=>a.id!==e)),onBlockedWordUpdate:(e,a,l)=>{V(J.map(r=>r.id===e?{...r,[a]:l}:r))},accessToken:r,showStep:e}):null},ec=()=>{var e;if(!c)return null;if(W)return(0,n.jsx)(eF,{value:U,onChange:q});if(!E)return null;console.log("guardrail_provider_map: ",C),console.log("selectedProvider: ",c);let a=null===(e=C[c])||void 0===e?void 0:e.toLowerCase(),l=E&&E[a];return l&&l.optional_params?(0,n.jsx)(el,{optionalParams:l.optional_params,parentFieldKey:"optional_params"}):null};return(0,n.jsx)(y.Z,{title:"Add Guardrail",open:a,onCancel:ei,footer:null,width:700,children:(0,n.jsxs)(v.Z,{form:i,layout:"vertical",initialValues:{mode:"pre_call",default_on:!1},children:[(0,n.jsxs)(j.default,{current:A,className:"mb-6",children:[(0,n.jsx)(eJ,{title:"Basic Info"}),(0,n.jsx)(eJ,{title:Z(c)?"PII Configuration":P(c)?"Pattern Detection":"Provider Configuration"}),P(c)&&(0,n.jsx)(eJ,{title:"Blocked Keywords"})]}),(()=>{switch(A){case 0:return en();case 1:if(Z(c))return ed();if(P(c))return eo("patterns");return ec();case 2:if(P(c))return eo("keywords");return null;default:return null}})(),(()=>{let e=A===(P(c)?3:2)-1;return(0,n.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[A>0&&(0,n.jsx)(b.z,{variant:"secondary",onClick:ea,children:"Previous"}),!e&&(0,n.jsx)(b.z,{onClick:ee,children:"Next"}),e&&(0,n.jsx)(b.z,{onClick:es,loading:s,children:"Create Guardrail"}),(0,n.jsx)(b.z,{variant:"secondary",onClick:ei,children:"Cancel"})]})})()]})})},eq=l(47323),eW=l(21626),eY=l(97214),eH=l(28241),e$=l(58834),eQ=l(69552),eX=l(71876),e0=l(74998),e1=l(44633),e4=l(86462),e2=l(49084),e5=l(1309),e8=l(71594),e6=l(24525),e3=l(63709);let{Title:e9,Text:e7}=g.default,{Option:ae}=f.default;var aa=e=>{var a;let{visible:l,onClose:r,accessToken:t,onSuccess:i,guardrailId:s,initialValues:o}=e,[c]=v.Z.useForm(),[u,m]=(0,d.useState)(!1),[x,h]=(0,d.useState)((null==o?void 0:o.provider)||null),[g,j]=(0,d.useState)(null),[_,N]=(0,d.useState)([]),[w,S]=(0,d.useState)({});(0,d.useEffect)(()=>{(async()=>{try{if(!t)return;let e=await (0,p.getGuardrailUISettings)(t);j(e)}catch(e){console.error("Error fetching guardrail settings:",e),er.Z.fromBackend("Failed to load guardrail settings")}})()},[t]),(0,d.useEffect)(()=>{(null==o?void 0:o.pii_entities_config)&&Object.keys(o.pii_entities_config).length>0&&(N(Object.keys(o.pii_entities_config)),S(o.pii_entities_config))},[o]);let Z=e=>{N(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},P=(e,a)=>{S(l=>({...l,[e]:a}))},O=async()=>{try{m(!0);let e=await c.validateFields(),a=C[e.provider],l={guardrail_id:s,guardrail:{guardrail_name:e.guardrail_name,dheera_ai_params:{guardrail:a,mode:e.mode,default_on:e.default_on},guardrail_info:{}}};if("PresidioPII"===e.provider&&_.length>0){let e={};_.forEach(a=>{e[a]=w[a]||"MASK"}),l.guardrail.dheera_ai_params.pii_entities_config=e}else if(e.config)try{let a=JSON.parse(e.config);"Bedrock"===e.provider&&a?(a.guardrail_id&&(l.guardrail.dheera_ai_params.guardrailIdentifier=a.guardrail_id),a.guardrail_version&&(l.guardrail.dheera_ai_params.guardrailVersion=a.guardrail_version)):l.guardrail.guardrail_info=a}catch(e){er.Z.fromBackend("Invalid JSON in configuration"),m(!1);return}if(!t)throw Error("No access token available");console.log("Sending guardrail update data:",JSON.stringify(l));let n=await fetch("/guardrails/".concat(s),{method:"PUT",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(l)});if(!n.ok){let e=await n.text();throw Error(e||"Failed to update guardrail")}er.Z.success("Guardrail updated successfully"),i(),r()}catch(e){console.error("Failed to update guardrail:",e),er.Z.fromBackend("Failed to update guardrail: "+(e instanceof Error?e.message:String(e)))}finally{m(!1)}},A=()=>g&&x&&"PresidioPII"===x?(0,n.jsx)(Y,{entities:g.supported_entities,actions:g.supported_actions,selectedEntities:_,selectedActions:w,onEntitySelect:Z,onActionSelect:P,entityCategories:g.pii_entity_categories}):null;return(0,n.jsx)(y.Z,{title:"Edit Guardrail",open:l,onCancel:r,footer:null,width:700,children:(0,n.jsxs)(v.Z,{form:c,layout:"vertical",initialValues:o,children:[(0,n.jsx)(v.Z.Item,{name:"guardrail_name",label:"Guardrail Name",rules:[{required:!0,message:"Please enter a guardrail name"}],children:(0,n.jsx)(b.o,{placeholder:"Enter a name for this guardrail"})}),(0,n.jsx)(v.Z.Item,{name:"provider",label:"Guardrail Provider",rules:[{required:!0,message:"Please select a provider"}],children:(0,n.jsx)(f.default,{placeholder:"Select a guardrail provider",onChange:e=>{h(e),c.setFieldsValue({config:void 0}),N([]),S({})},disabled:!0,optionLabelProp:"label",children:Object.entries(k()).map(e=>{let[a,l]=e;return(0,n.jsx)(ae,{value:a,label:l,children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[I[l]&&(0,n.jsx)("img",{src:I[l],alt:"",style:{height:"20px",width:"20px",marginRight:"8px",objectFit:"contain"},onError:e=>{e.currentTarget.style.display="none"}}),(0,n.jsx)("span",{children:l})]})},a)})})}),(0,n.jsx)(v.Z.Item,{name:"mode",label:"Mode",tooltip:"How the guardrail should be applied",rules:[{required:!0,message:"Please select a mode"}],children:(0,n.jsx)(f.default,{children:(null==g?void 0:null===(a=g.supported_modes)||void 0===a?void 0:a.map(e=>(0,n.jsx)(ae,{value:e,children:e},e)))||(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ae,{value:"pre_call",children:"pre_call"}),(0,n.jsx)(ae,{value:"post_call",children:"post_call"})]})})}),(0,n.jsx)(v.Z.Item,{name:"default_on",label:"Always On",tooltip:"If enabled, this guardrail will be applied to all requests by default",valuePropName:"checked",children:(0,n.jsx)(e3.Z,{})}),(()=>{if(!x)return null;if("PresidioPII"===x)return A();switch(x){case"Aporia":return(0,n.jsx)(v.Z.Item,{label:"Aporia Configuration",name:"config",tooltip:"JSON configuration for Aporia",children:(0,n.jsx)(eL.default.TextArea,{rows:4,placeholder:'{\n  "api_key": "your_aporia_api_key",\n  "project_name": "your_project_name"\n}'})});case"AimSecurity":return(0,n.jsx)(v.Z.Item,{label:"Aim Security Configuration",name:"config",tooltip:"JSON configuration for Aim Security",children:(0,n.jsx)(eL.default.TextArea,{rows:4,placeholder:'{\n  "api_key": "your_aim_api_key"\n}'})});case"Bedrock":return(0,n.jsx)(v.Z.Item,{label:"Amazon Bedrock Configuration",name:"config",tooltip:"JSON configuration for Amazon Bedrock guardrails",children:(0,n.jsx)(eL.default.TextArea,{rows:4,placeholder:'{\n  "guardrail_id": "your_guardrail_id",\n  "guardrail_version": "your_guardrail_version"\n}'})});case"GuardrailsAI":return(0,n.jsx)(v.Z.Item,{label:"Guardrails.ai Configuration",name:"config",tooltip:"JSON configuration for Guardrails.ai",children:(0,n.jsx)(eL.default.TextArea,{rows:4,placeholder:'{\n  "api_key": "your_guardrails_api_key",\n  "guardrail_id": "your_guardrail_id"\n}'})});case"LakeraAI":return(0,n.jsx)(v.Z.Item,{label:"Lakera AI Configuration",name:"config",tooltip:"JSON configuration for Lakera AI",children:(0,n.jsx)(eL.default.TextArea,{rows:4,placeholder:'{\n  "api_key": "your_lakera_api_key"\n}'})});case"PromptInjection":return(0,n.jsx)(v.Z.Item,{label:"Prompt Injection Configuration",name:"config",tooltip:"JSON configuration for prompt injection detection",children:(0,n.jsx)(eL.default.TextArea,{rows:4,placeholder:'{\n  "threshold": 0.8\n}'})});default:return(0,n.jsx)(v.Z.Item,{label:"Custom Configuration",name:"config",tooltip:"JSON configuration for your custom guardrail",children:(0,n.jsx)(eL.default.TextArea,{rows:4,placeholder:'{\n  "key1": "value1",\n  "key2": "value2"\n}'})})}})(),(0,n.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,n.jsx)(b.z,{variant:"secondary",onClick:r,children:"Cancel"}),(0,n.jsx)(b.z,{onClick:O,loading:u,children:"Update Guardrail"})]})]})})};(t=s||(s={})).DB="db",t.CONFIG="config";var al=e=>{let{guardrailsList:a,isLoading:l,onDeleteClick:r,accessToken:t,onGuardrailUpdated:i,isAdmin:c=!1,onGuardrailClick:u}=e,[m,x]=(0,d.useState)([{id:"created_at",desc:!0}]),[h,p]=(0,d.useState)(!1),[g,f]=(0,d.useState)(null),j=e=>e?new Date(e).toLocaleString():"-",v=[{header:"Guardrail ID",accessorKey:"guardrail_id",cell:e=>(0,n.jsx)(L.Z,{title:String(e.getValue()||""),children:(0,n.jsx)(o.Z,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate max-w-[200px]",onClick:()=>e.getValue()&&u(e.getValue()),children:e.getValue()?"".concat(String(e.getValue()).slice(0,7),"..."):""})})},{header:"Name",accessorKey:"guardrail_name",cell:e=>{let{row:a}=e,l=a.original;return(0,n.jsx)(L.Z,{title:l.guardrail_name,children:(0,n.jsx)("span",{className:"text-xs font-medium",children:l.guardrail_name||"-"})})}},{header:"Provider",accessorKey:"dheera_ai_params.guardrail",cell:e=>{let{row:a}=e,{logo:l,displayName:r}=A(a.original.dheera_ai_params.guardrail);return(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[l&&(0,n.jsx)("img",{src:l,alt:"".concat(r," logo"),className:"w-4 h-4",onError:e=>{e.target.style.display="none"}}),(0,n.jsx)("span",{className:"text-xs",children:r})]})}},{header:"Mode",accessorKey:"dheera_ai_params.mode",cell:e=>{let{row:a}=e,l=a.original;return(0,n.jsx)("span",{className:"text-xs",children:l.dheera_ai_params.mode})}},{header:"Default On",accessorKey:"dheera_ai_params.default_on",cell:e=>{var a,l;let{row:r}=e,t=r.original;return(0,n.jsx)(e5.C,{color:(null===(a=t.dheera_ai_params)||void 0===a?void 0:a.default_on)?"green":"gray",className:"text-xs font-normal",size:"xs",children:(null===(l=t.dheera_ai_params)||void 0===l?void 0:l.default_on)?"Default On":"Default Off"})}},{header:"Created At",accessorKey:"created_at",cell:e=>{let{row:a}=e,l=a.original;return(0,n.jsx)(L.Z,{title:l.created_at,children:(0,n.jsx)("span",{className:"text-xs",children:j(l.created_at)})})}},{header:"Updated At",accessorKey:"updated_at",cell:e=>{let{row:a}=e,l=a.original;return(0,n.jsx)(L.Z,{title:l.updated_at,children:(0,n.jsx)("span",{className:"text-xs",children:j(l.updated_at)})})}},{id:"actions",header:"Actions",cell:e=>{let{row:a}=e,l=a.original,t=l.guardrail_definition_location===s.CONFIG;return(0,n.jsx)("div",{className:"flex space-x-2",children:t?(0,n.jsx)(L.Z,{title:"Config guardrail cannot be deleted on the dashboard. Please delete it from the config file.",children:(0,n.jsx)(eq.Z,{"data-testid":"config-delete-icon",icon:e0.Z,size:"sm",className:"cursor-not-allowed text-gray-400",title:"Config guardrail cannot be deleted on the dashboard. Please delete it from the config file.","aria-label":"Delete guardrail (config)"})}):(0,n.jsx)(L.Z,{title:"Delete guardrail",children:(0,n.jsx)(eq.Z,{icon:e0.Z,size:"sm",onClick:()=>l.guardrail_id&&r(l.guardrail_id,l.guardrail_name||"Unnamed Guardrail"),className:"cursor-pointer hover:text-red-500"})})})}}],_=(0,e8.b7)({data:a,columns:v,state:{sorting:m},onSortingChange:x,getCoreRowModel:(0,e6.sC)(),getSortedRowModel:(0,e6.tj)(),enableSorting:!0});return(0,n.jsxs)("div",{className:"rounded-lg custom-border relative",children:[(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)(eW.Z,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,n.jsx)(e$.Z,{children:_.getHeaderGroups().map(e=>(0,n.jsx)(eX.Z,{children:e.headers.map(e=>(0,n.jsx)(eQ.Z,{className:"py-1 h-8 ".concat("actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),onClick:e.column.getToggleSortingHandler(),children:(0,n.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,n.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,e8.ie)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,n.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,n.jsx)(e1.Z,{className:"h-4 w-4 text-blue-500"}),desc:(0,n.jsx)(e4.Z,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,n.jsx)(e2.Z,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,n.jsx)(eY.Z,{children:l?(0,n.jsx)(eX.Z,{children:(0,n.jsx)(eH.Z,{colSpan:v.length,className:"h-8 text-center",children:(0,n.jsx)("div",{className:"text-center text-gray-500",children:(0,n.jsx)("p",{children:"Loading..."})})})}):a.length>0?_.getRowModel().rows.map(e=>(0,n.jsx)(eX.Z,{className:"h-8",children:e.getVisibleCells().map(e=>(0,n.jsx)(eH.Z,{className:"py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ".concat("actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),children:(0,e8.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,n.jsx)(eX.Z,{children:(0,n.jsx)(eH.Z,{colSpan:v.length,className:"h-8 text-center",children:(0,n.jsx)("div",{className:"text-center text-gray-500",children:(0,n.jsx)("p",{children:"No guardrails found"})})})})})]})}),g&&(0,n.jsx)(aa,{visible:h,onClose:()=>p(!1),accessToken:t,onSuccess:()=>{p(!1),f(null),i()},guardrailId:g.guardrail_id||"",initialValues:{guardrail_name:g.guardrail_name||"",provider:Object.keys(C).find(e=>C[e]===(null==g?void 0:g.dheera_ai_params.guardrail))||"",mode:g.dheera_ai_params.mode,default_on:g.dheera_ai_params.default_on,pii_entities_config:g.dheera_ai_params.pii_entities_config,...g.guardrail_info}})]})},ar=l(20347),at=l(30078),ai=l(41649),as=l(12514),an=l(84264),ad=e=>{let{patterns:a,blockedWords:l,readOnly:r=!0,onPatternActionChange:t,onPatternRemove:i,onBlockedWordUpdate:s,onBlockedWordRemove:d}=e;if(0===a.length&&0===l.length)return null;let o=()=>{};return(0,n.jsxs)(n.Fragment,{children:[a.length>0&&(0,n.jsxs)(as.Z,{className:"mt-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)(an.Z,{className:"text-lg font-semibold",children:"Pattern Detection"}),(0,n.jsxs)(ai.Z,{color:"blue",children:[a.length," patterns configured"]})]}),(0,n.jsx)(ek,{patterns:a,onActionChange:r?o:t||o,onRemove:r?o:i||o})]}),l.length>0&&(0,n.jsxs)(as.Z,{className:"mt-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)(an.Z,{className:"text-lg font-semibold",children:"Blocked Keywords"}),(0,n.jsxs)(ai.Z,{color:"blue",children:[l.length," keywords configured"]})]}),(0,n.jsx)(eZ,{keywords:l,onActionChange:r?o:s||o,onRemove:r?o:d||o})]})]})},ao=e=>{var a;let{guardrailData:l,guardrailSettings:r,isEditing:t,accessToken:i,onDataChange:s,onUnsavedChanges:o}=e,[c,u]=(0,d.useState)([]),[m,x]=(0,d.useState)([]),[h,p]=(0,d.useState)([]),[g,f]=(0,d.useState)([]);(0,d.useEffect)(()=>{var e,a;if(null==l?void 0:null===(e=l.dheera_ai_params)||void 0===e?void 0:e.patterns){let e=l.dheera_ai_params.patterns.map((e,a)=>({id:"pattern-".concat(a),type:"prebuilt"===e.pattern_type?"prebuilt":"custom",name:e.pattern_name||e.name,display_name:e.display_name,pattern:e.pattern,action:e.action||"BLOCK"}));u(e),p(e)}else u([]),p([]);if(null==l?void 0:null===(a=l.dheera_ai_params)||void 0===a?void 0:a.blocked_words){let e=l.dheera_ai_params.blocked_words.map((e,a)=>({id:"word-".concat(a),keyword:e.keyword,action:e.action||"BLOCK",description:e.description}));x(e),f(e)}else x([]),f([])},[l]),(0,d.useEffect)(()=>{s&&s(c,m)},[c,m,s]);let j=d.useMemo(()=>{let e=JSON.stringify(c)!==JSON.stringify(h),a=JSON.stringify(m)!==JSON.stringify(g);return e||a},[c,m,h,g]);return((0,d.useEffect)(()=>{t&&o&&o(j)},[j,t,o]),(null==l?void 0:null===(a=l.dheera_ai_params)||void 0===a?void 0:a.guardrail)!=="dheera_ai_content_filter")?null:t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eE.Z,{orientation:"left",children:"Content Filter Configuration"}),j&&(0,n.jsx)("div",{className:"mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-md",children:(0,n.jsx)("p",{className:"text-sm text-yellow-800 font-medium",children:'âš ï¸ You have unsaved changes to patterns or keywords. Remember to click "Save Changes" at the bottom.'})}),(0,n.jsx)("div",{className:"mb-6",children:r&&r.content_filter_settings&&(0,n.jsx)(eI,{prebuiltPatterns:r.content_filter_settings.prebuilt_patterns||[],categories:r.content_filter_settings.pattern_categories||[],selectedPatterns:c,blockedWords:m,onPatternAdd:e=>u([...c,e]),onPatternRemove:e=>u(c.filter(a=>a.id!==e)),onPatternActionChange:(e,a)=>u(c.map(l=>l.id===e?{...l,action:a}:l)),onBlockedWordAdd:e=>x([...m,e]),onBlockedWordRemove:e=>x(m.filter(a=>a.id!==e)),onBlockedWordUpdate:(e,a,l)=>x(m.map(r=>r.id===e?{...r,[a]:l}:r)),onFileUpload:e=>{console.log("File uploaded:",e)},accessToken:i})})]}):(0,n.jsx)(ad,{patterns:c,blockedWords:m,readOnly:!0})};let ac=(e,a)=>({patterns:e.map(e=>({pattern_type:"prebuilt"===e.type?"prebuilt":"regex",pattern_name:"prebuilt"===e.type?e.name:void 0,pattern:"custom"===e.type?e.pattern:void 0,name:e.name,action:e.action})),blocked_words:a.map(e=>({keyword:e.keyword,action:e.action,description:e.description}))});var au=l(77331),am=l(59872),ax=l(30401),ah=l(78867),ap=e=>{var a,l,r,t,i,s,o,c,u,m,x,h,g,j,_,y;let{guardrailId:b,onClose:N,accessToken:w,isAdmin:k}=e,[S,Z]=(0,d.useState)(null),[P,O]=(0,d.useState)(null),[I,T]=(0,d.useState)(!0),[G,F]=(0,d.useState)(!1),[D]=v.Z.useForm(),[K,M]=(0,d.useState)([]),[R,J]=(0,d.useState)({}),[V,U]=(0,d.useState)(null),[q,W]=(0,d.useState)({}),[H,$]=(0,d.useState)(!1),Q={rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""},[ee,ea]=(0,d.useState)(Q),[et,ei]=(0,d.useState)(!1),es=d.useRef({patterns:[],blockedWords:[]}),en=(0,d.useCallback)((e,a)=>{es.current={patterns:e,blockedWords:a}},[]),ed=async()=>{try{var e;if(T(!0),!w)return;let a=await (0,p.getGuardrailInfo)(w,b);if(Z(a),null===(e=a.dheera_ai_params)||void 0===e?void 0:e.pii_entities_config){let e=a.dheera_ai_params.pii_entities_config;if(M([]),J({}),Object.keys(e).length>0){let a=[],l={};Object.entries(e).forEach(e=>{let[r,t]=e;a.push(r),l[r]="string"==typeof t?t:"MASK"}),M(a),J(l)}}else M([]),J({})}catch(e){er.Z.fromBackend("Failed to load guardrail information"),console.error("Error fetching guardrail info:",e)}finally{T(!1)}},eo=async()=>{try{if(!w)return;let e=await (0,p.getGuardrailProviderSpecificParams)(w);O(e)}catch(e){console.error("Error fetching guardrail provider specific params:",e)}},ec=async()=>{try{if(!w)return;let e=await (0,p.getGuardrailUISettings)(w);U(e)}catch(e){console.error("Error fetching guardrail UI settings:",e)}};(0,d.useEffect)(()=>{eo()},[w]),(0,d.useEffect)(()=>{ed(),ec()},[b,w]),(0,d.useEffect)(()=>{if(S&&D){var e;D.setFieldsValue({guardrail_name:S.guardrail_name,...S.dheera_ai_params,guardrail_info:S.guardrail_info?JSON.stringify(S.guardrail_info,null,2):"",...(null===(e=S.dheera_ai_params)||void 0===e?void 0:e.optional_params)&&{optional_params:S.dheera_ai_params.optional_params}})}},[S,P,D]);let eu=(0,d.useCallback)(()=>{var e,a,l,r,t;(null==S?void 0:null===(e=S.dheera_ai_params)||void 0===e?void 0:e.guardrail)==="tool_permission"?ea({rules:(null===(a=S.dheera_ai_params)||void 0===a?void 0:a.rules)||[],default_action:((null===(l=S.dheera_ai_params)||void 0===l?void 0:l.default_action)||"deny").toLowerCase(),on_disallowed_action:((null===(r=S.dheera_ai_params)||void 0===r?void 0:r.on_disallowed_action)||"block").toLowerCase(),violation_message_template:(null===(t=S.dheera_ai_params)||void 0===t?void 0:t.violation_message_template)||""}):ea(Q),ei(!1)},[S]);(0,d.useEffect)(()=>{eu()},[eu]);let em=async e=>{try{var a,l,r,t,i,s,n,d,o,c,u,m;if(!w)return;let x={dheera_ai_params:{}};e.guardrail_name!==S.guardrail_name&&(x.guardrail_name=e.guardrail_name),e.default_on!==(null===(a=S.dheera_ai_params)||void 0===a?void 0:a.default_on)&&(x.dheera_ai_params.default_on=e.default_on);let h=S.guardrail_info,g=e.guardrail_info?JSON.parse(e.guardrail_info):void 0;JSON.stringify(h)!==JSON.stringify(g)&&(x.guardrail_info=g);let f=(null===(l=S.dheera_ai_params)||void 0===l?void 0:l.pii_entities_config)||{},j={};if(K.forEach(e=>{j[e]=R[e]||"MASK"}),JSON.stringify(f)!==JSON.stringify(j)&&(x.dheera_ai_params.pii_entities_config=j),(null===(r=S.dheera_ai_params)||void 0===r?void 0:r.guardrail)==="dheera_ai_content_filter"){let e=(null===(s=S.dheera_ai_params)||void 0===s?void 0:s.patterns)||[],a=(null===(n=S.dheera_ai_params)||void 0===n?void 0:n.blocked_words)||[],l=ac(es.current.patterns,es.current.blockedWords);JSON.stringify(e)!==JSON.stringify(l.patterns)&&(x.dheera_ai_params.patterns=l.patterns),JSON.stringify(a)!==JSON.stringify(l.blocked_words)&&(x.dheera_ai_params.blocked_words=l.blocked_words)}if((null===(t=S.dheera_ai_params)||void 0===t?void 0:t.guardrail)==="tool_permission"){let e=(null===(d=S.dheera_ai_params)||void 0===d?void 0:d.rules)||[],a=ee.rules||[],l=JSON.stringify(e)!==JSON.stringify(a),r=((null===(o=S.dheera_ai_params)||void 0===o?void 0:o.default_action)||"deny").toLowerCase(),t=(ee.default_action||"deny").toLowerCase(),i=r!==t,s=((null===(c=S.dheera_ai_params)||void 0===c?void 0:c.on_disallowed_action)||"block").toLowerCase(),n=(ee.on_disallowed_action||"block").toLowerCase(),m=s!==n,h=(null===(u=S.dheera_ai_params)||void 0===u?void 0:u.violation_message_template)||"",p=ee.violation_message_template||"",g=h!==p;(et||l||i||m||g)&&(x.dheera_ai_params.rules=a,x.dheera_ai_params.default_action=t,x.dheera_ai_params.on_disallowed_action=n,x.dheera_ai_params.violation_message_template=p||null)}let v=Object.keys(C).find(e=>{var a;return C[e]===(null===(a=S.dheera_ai_params)||void 0===a?void 0:a.guardrail)});console.log("values: ",JSON.stringify(e)),console.log("currentProvider: ",v);let _=(null===(i=S.dheera_ai_params)||void 0===i?void 0:i.guardrail)==="tool_permission";if(P&&v&&!_){let a=P[null===(m=C[v])||void 0===m?void 0:m.toLowerCase()]||{},l=new Set;console.log("providerSpecificParams: ",JSON.stringify(a)),Object.keys(a).forEach(e=>{"optional_params"!==e&&l.add(e)}),a.optional_params&&a.optional_params.fields&&Object.keys(a.optional_params.fields).forEach(e=>{l.add(e)}),console.log("allowedParams: ",l),l.forEach(a=>{var l,r;let t=e[a];(null==t||""===t)&&(t=null===(r=e.optional_params)||void 0===r?void 0:r[a]);let i=null===(l=S.dheera_ai_params)||void 0===l?void 0:l[a];JSON.stringify(t)!==JSON.stringify(i)&&(null!=t&&""!==t?x.dheera_ai_params[a]=t:null!=i&&""!==i&&(x.dheera_ai_params[a]=null))})}if(0===Object.keys(x.dheera_ai_params).length&&delete x.dheera_ai_params,0===Object.keys(x).length){er.Z.info("No changes detected"),F(!1);return}await (0,p.updateGuardrailCall)(w,b,x),er.Z.success("Guardrail updated successfully"),$(!1),ed(),F(!1)}catch(e){console.error("Error updating guardrail:",e),er.Z.fromBackend("Failed to update guardrail")}};if(I)return(0,n.jsx)("div",{className:"p-4",children:"Loading..."});if(!S)return(0,n.jsx)("div",{className:"p-4",children:"Guardrail not found"});let ex=e=>e?new Date(e).toLocaleString():"-",{logo:eh,displayName:ep}=A((null===(a=S.dheera_ai_params)||void 0===a?void 0:a.guardrail)||""),eg=async(e,a)=>{await (0,am.vQ)(e)&&(W(e=>({...e,[a]:!0})),setTimeout(()=>{W(e=>({...e,[a]:!1}))},2e3))},ef="config"===S.guardrail_definition_location;return(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(at.zx,{icon:au.Z,variant:"light",onClick:N,className:"mb-4",children:"Back to Guardrails"}),(0,n.jsx)(at.Dx,{children:S.guardrail_name||"Unnamed Guardrail"}),(0,n.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,n.jsx)(at.xv,{className:"text-gray-500 font-mono",children:S.guardrail_id}),(0,n.jsx)(E.ZP,{type:"text",size:"small",icon:q["guardrail-id"]?(0,n.jsx)(ax.Z,{size:12}):(0,n.jsx)(ah.Z,{size:12}),onClick:()=>eg(S.guardrail_id,"guardrail-id"),className:"left-2 z-10 transition-all duration-200 ".concat(q["guardrail-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100")})]})]}),(0,n.jsxs)(at.v0,{children:[(0,n.jsxs)(at.td,{className:"mb-4",children:[(0,n.jsx)(at.OK,{children:"Overview"},"overview"),k?(0,n.jsx)(at.OK,{children:"Settings"},"settings"):(0,n.jsx)(n.Fragment,{})]}),(0,n.jsxs)(at.nP,{children:[(0,n.jsxs)(at.x4,{children:[(0,n.jsxs)(at.rj,{numItems:1,numItemsSm:2,numItemsLg:3,className:"gap-6",children:[(0,n.jsxs)(at.Zb,{children:[(0,n.jsx)(at.xv,{children:"Provider"}),(0,n.jsxs)("div",{className:"mt-2 flex items-center space-x-2",children:[eh&&(0,n.jsx)("img",{src:eh,alt:"".concat(ep," logo"),className:"w-6 h-6",onError:e=>{e.target.style.display="none"}}),(0,n.jsx)(at.Dx,{children:ep})]})]}),(0,n.jsxs)(at.Zb,{children:[(0,n.jsx)(at.xv,{children:"Mode"}),(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)(at.Dx,{children:(null===(l=S.dheera_ai_params)||void 0===l?void 0:l.mode)||"-"}),(0,n.jsx)(at.Ct,{color:(null===(r=S.dheera_ai_params)||void 0===r?void 0:r.default_on)?"green":"gray",children:(null===(t=S.dheera_ai_params)||void 0===t?void 0:t.default_on)?"Default On":"Default Off"})]})]}),(0,n.jsxs)(at.Zb,{children:[(0,n.jsx)(at.xv,{children:"Created At"}),(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)(at.Dx,{children:ex(S.created_at)}),(0,n.jsxs)(at.xv,{children:["Last Updated: ",ex(S.updated_at)]})]})]})]}),(null===(i=S.dheera_ai_params)||void 0===i?void 0:i.pii_entities_config)&&Object.keys(S.dheera_ai_params.pii_entities_config).length>0&&(0,n.jsx)(at.Zb,{className:"mt-6",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)(at.xv,{className:"font-medium",children:"PII Protection"}),(0,n.jsxs)(at.Ct,{color:"blue",children:[Object.keys(S.dheera_ai_params.pii_entities_config).length," PII entities configured"]})]})}),(null===(s=S.dheera_ai_params)||void 0===s?void 0:s.pii_entities_config)&&Object.keys(S.dheera_ai_params.pii_entities_config).length>0&&(0,n.jsxs)(at.Zb,{className:"mt-6",children:[(0,n.jsx)(at.xv,{className:"mb-4 text-lg font-semibold",children:"PII Entity Configuration"}),(0,n.jsxs)("div",{className:"border rounded-lg overflow-hidden shadow-sm",children:[(0,n.jsxs)("div",{className:"bg-gray-50 px-5 py-3 border-b flex",children:[(0,n.jsx)(at.xv,{className:"flex-1 font-semibold text-gray-700",children:"Entity Type"}),(0,n.jsx)(at.xv,{className:"flex-1 font-semibold text-gray-700",children:"Configuration"})]}),(0,n.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:Object.entries(null===(o=S.dheera_ai_params)||void 0===o?void 0:o.pii_entities_config).map(e=>{let[a,l]=e;return(0,n.jsxs)("div",{className:"px-5 py-3 flex border-b hover:bg-gray-50 transition-colors",children:[(0,n.jsx)(at.xv,{className:"flex-1 font-medium text-gray-900",children:a}),(0,n.jsx)(at.xv,{className:"flex-1",children:(0,n.jsxs)("span",{className:"inline-flex items-center gap-1.5 ".concat("MASK"===l?"text-blue-600":"text-red-600"),children:["MASK"===l?(0,n.jsx)(z.Z,{}):(0,n.jsx)(B.Z,{}),String(l)]})})]},a)})})]})]}),(null===(c=S.dheera_ai_params)||void 0===c?void 0:c.guardrail)==="tool_permission"&&(0,n.jsx)(at.Zb,{className:"mt-6",children:(0,n.jsx)(eF,{value:ee,disabled:!0})}),(0,n.jsx)(ao,{guardrailData:S,guardrailSettings:V,isEditing:!1,accessToken:w})]}),k&&(0,n.jsx)(at.x4,{children:(0,n.jsxs)(at.Zb,{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)(at.Dx,{children:"Guardrail Settings"}),ef&&(0,n.jsx)(L.Z,{title:"Guardrail is defined in the config file and cannot be edited.",children:(0,n.jsx)(ez.Z,{})}),!G&&!ef&&(0,n.jsx)(at.zx,{onClick:()=>F(!0),children:"Edit Settings"})]}),G?(0,n.jsxs)(v.Z,{form:D,onFinish:em,initialValues:{guardrail_name:S.guardrail_name,...S.dheera_ai_params,guardrail_info:S.guardrail_info?JSON.stringify(S.guardrail_info,null,2):"",...(null===(u=S.dheera_ai_params)||void 0===u?void 0:u.optional_params)&&{optional_params:S.dheera_ai_params.optional_params}},layout:"vertical",children:[(0,n.jsx)(v.Z.Item,{label:"Guardrail Name",name:"guardrail_name",rules:[{required:!0,message:"Please input a guardrail name"}],children:(0,n.jsx)(at.oi,{})}),(0,n.jsx)(v.Z.Item,{label:"Default On",name:"default_on",children:(0,n.jsxs)(f.default,{children:[(0,n.jsx)(f.default.Option,{value:!0,children:"Yes"}),(0,n.jsx)(f.default.Option,{value:!1,children:"No"})]})}),(null===(m=S.dheera_ai_params)||void 0===m?void 0:m.guardrail)==="presidio"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eE.Z,{orientation:"left",children:"PII Protection"}),(0,n.jsx)("div",{className:"mb-6",children:V&&(0,n.jsx)(Y,{entities:V.supported_entities,actions:V.supported_actions,selectedEntities:K,selectedActions:R,onEntitySelect:e=>{M(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},onActionSelect:(e,a)=>{J(l=>({...l,[e]:a}))},entityCategories:V.pii_entity_categories})})]}),(0,n.jsx)(ao,{guardrailData:S,guardrailSettings:V,isEditing:!0,accessToken:w,onDataChange:en,onUnsavedChanges:$}),(0,n.jsx)(eE.Z,{orientation:"left",children:"Provider Settings"}),(null===(x=S.dheera_ai_params)||void 0===x?void 0:x.guardrail)==="tool_permission"?(0,n.jsx)(eF,{value:ee,onChange:ea}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(X,{selectedProvider:Object.keys(C).find(e=>{var a;return C[e]===(null===(a=S.dheera_ai_params)||void 0===a?void 0:a.guardrail)})||null,accessToken:w,providerParams:P,value:S.dheera_ai_params}),P&&(()=>{var e;let a=Object.keys(C).find(e=>{var a;return C[e]===(null===(a=S.dheera_ai_params)||void 0===a?void 0:a.guardrail)});if(!a)return null;let l=P[null===(e=C[a])||void 0===e?void 0:e.toLowerCase()];return l&&l.optional_params?(0,n.jsx)(el,{optionalParams:l.optional_params,parentFieldKey:"optional_params",values:S.dheera_ai_params}):null})()]}),(0,n.jsx)(eE.Z,{orientation:"left",children:"Advanced Settings"}),(0,n.jsx)(v.Z.Item,{label:"Guardrail Information",name:"guardrail_info",children:(0,n.jsx)(eL.default.TextArea,{rows:5})}),(0,n.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,n.jsx)(E.ZP,{onClick:()=>{F(!1),$(!1),eu()},children:"Cancel"}),(0,n.jsx)(at.zx,{children:"Save Changes"})]})]}):(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(at.xv,{className:"font-medium",children:"Guardrail ID"}),(0,n.jsx)("div",{className:"font-mono",children:S.guardrail_id})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(at.xv,{className:"font-medium",children:"Guardrail Name"}),(0,n.jsx)("div",{children:S.guardrail_name||"Unnamed Guardrail"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(at.xv,{className:"font-medium",children:"Provider"}),(0,n.jsx)("div",{children:ep})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(at.xv,{className:"font-medium",children:"Mode"}),(0,n.jsx)("div",{children:(null===(h=S.dheera_ai_params)||void 0===h?void 0:h.mode)||"-"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(at.xv,{className:"font-medium",children:"Default On"}),(0,n.jsx)(at.Ct,{color:(null===(g=S.dheera_ai_params)||void 0===g?void 0:g.default_on)?"green":"gray",children:(null===(j=S.dheera_ai_params)||void 0===j?void 0:j.default_on)?"Yes":"No"})]}),(null===(_=S.dheera_ai_params)||void 0===_?void 0:_.pii_entities_config)&&Object.keys(S.dheera_ai_params.pii_entities_config).length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)(at.xv,{className:"font-medium",children:"PII Protection"}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsxs)(at.Ct,{color:"blue",children:[Object.keys(S.dheera_ai_params.pii_entities_config).length," PII entities configured"]})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(at.xv,{className:"font-medium",children:"Created At"}),(0,n.jsx)("div",{children:ex(S.created_at)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(at.xv,{className:"font-medium",children:"Last Updated"}),(0,n.jsx)("div",{children:ex(S.updated_at)})]}),(null===(y=S.dheera_ai_params)||void 0===y?void 0:y.guardrail)==="tool_permission"&&(0,n.jsx)(eF,{value:ee,disabled:!0})]})]})})]})]})]})},ag=l(96761),af=l(35631),aj=l(29436),av=l(41169),a_=l(23639),ay=l(77565),ab=l(70464),aN=l(83669),aw=l(5540);let{Text:ak}=g.default;var aC=function(e){let{results:a,errors:l}=e,[r,t]=(0,d.useState)(new Set),i=e=>{let a=new Set(r);a.has(e)?a.delete(e):a.add(e),t(a)},s=async e=>{try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),!0;{let a=document.createElement("textarea");a.value=e,a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.focus(),a.select();let l=document.execCommand("copy");if(document.body.removeChild(a),!l)throw Error("execCommand failed");return!0}}catch(e){return console.error("Copy failed:",e),!1}};return a||l?(0,n.jsxs)("div",{className:"space-y-3 pt-4 border-t border-gray-200",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Results"}),a&&a.map(e=>{let a=r.has(e.guardrailName);return(0,n.jsx)(as.Z,{className:"bg-green-50 border-green-200",children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 cursor-pointer flex-1",onClick:()=>i(e.guardrailName),children:[a?(0,n.jsx)(ay.Z,{className:"text-gray-500 text-xs"}):(0,n.jsx)(ab.Z,{className:"text-gray-500 text-xs"}),(0,n.jsx)(aN.Z,{className:"text-green-600 text-lg"}),(0,n.jsx)("span",{className:"text-sm font-medium text-green-800",children:e.guardrailName})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-600",children:[(0,n.jsx)(aw.Z,{}),(0,n.jsxs)("span",{className:"font-medium",children:[e.latency,"ms"]})]}),!a&&(0,n.jsx)(o.Z,{size:"xs",variant:"secondary",icon:a_.Z,onClick:async()=>{await s(e.response_text)?er.Z.success("Result copied to clipboard"):er.Z.fromBackend("Failed to copy result")},children:"Copy"})]})]}),!a&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"bg-white border border-green-200 rounded p-3",children:[(0,n.jsx)("label",{className:"text-xs font-medium text-gray-600 mb-2 block",children:"Output Text"}),(0,n.jsx)("div",{className:"font-mono text-sm text-gray-900 whitespace-pre-wrap break-words",children:e.response_text})]}),(0,n.jsxs)("div",{className:"text-xs text-gray-600",children:[(0,n.jsx)("span",{className:"font-medium",children:"Characters:"})," ",e.response_text.length]})]})]})},e.guardrailName)}),l&&l.map(e=>{let a=r.has(e.guardrailName);return(0,n.jsx)(as.Z,{className:"bg-red-50 border-red-200",children:(0,n.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,n.jsx)("div",{className:"cursor-pointer mt-0.5",onClick:()=>i(e.guardrailName),children:a?(0,n.jsx)(ay.Z,{className:"text-gray-500 text-xs"}):(0,n.jsx)(ab.Z,{className:"text-gray-500 text-xs"})}),(0,n.jsx)("div",{className:"text-red-600 mt-0.5",children:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,n.jsxs)("p",{className:"text-sm font-medium text-red-800 cursor-pointer",onClick:()=>i(e.guardrailName),children:[e.guardrailName," - Error"]}),(0,n.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-600",children:[(0,n.jsx)(aw.Z,{}),(0,n.jsxs)("span",{className:"font-medium",children:[e.latency,"ms"]})]})]}),!a&&(0,n.jsx)("p",{className:"text-sm text-red-700 mt-1",children:e.error.message})]})]})},e.guardrailName)})]}):null};let{TextArea:aS}=eL.default,{Text:aZ}=g.default;var aP=function(e){let{guardrailNames:a,onSubmit:l,isLoading:r,results:t,errors:i,onClose:s}=e,[o,c]=(0,d.useState)(""),u=()=>{if(!o.trim()){er.Z.fromBackend("Please enter text to test");return}l(o)},m=async e=>{try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),!0;{let a=document.createElement("textarea");a.value=e,a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.focus(),a.select();let l=document.execCommand("copy");if(document.body.removeChild(a),!l)throw Error("execCommand failed");return!0}}catch(e){return console.error("Copy failed:",e),!1}},x=async()=>{await m(o)?er.Z.success("Input copied to clipboard"):er.Z.fromBackend("Failed to copy input")};return(0,n.jsxs)("div",{className:"space-y-4 h-full flex flex-col",children:[(0,n.jsx)("div",{className:"flex items-center justify-between pb-3 border-b border-gray-200",children:(0,n.jsx)("div",{className:"flex items-center space-x-3",children:(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Test Guardrails:"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:a.map(e=>(0,n.jsx)("div",{className:"inline-flex items-center space-x-1 bg-blue-50 px-3 py-1 rounded-md border border-blue-200",children:(0,n.jsx)("span",{className:"font-mono text-blue-700 font-medium text-sm",children:e})},e))})]}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["Test ",a.length>1?"guardrails":"guardrail"," and compare results"]})]})})}),(0,n.jsxs)("div",{className:"flex-1 overflow-auto space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Input Text"}),(0,n.jsx)(L.Z,{title:"Press Enter to submit. Use Shift+Enter for new line.",children:(0,n.jsx)(ez.Z,{className:"text-gray-400 cursor-help"})})]}),o&&(0,n.jsx)(eo.z,{size:"xs",variant:"secondary",icon:a_.Z,onClick:x,children:"Copy Input"})]}),(0,n.jsx)(aS,{value:o,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||e.ctrlKey||e.metaKey||(e.preventDefault(),u())},placeholder:"Enter text to test with guardrails...",rows:8,className:"font-mono text-sm"}),(0,n.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,n.jsxs)(aZ,{className:"text-xs text-gray-500",children:["Press ",(0,n.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs",children:"Enter"})," to submit â€¢ ",(0,n.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs",children:"Shift+Enter"})," for new line"]}),(0,n.jsxs)(aZ,{className:"text-xs text-gray-500",children:["Characters: ",o.length]})]})]}),(0,n.jsx)("div",{className:"pt-2",children:(0,n.jsx)(eo.z,{onClick:u,loading:r,disabled:!o.trim(),className:"w-full",children:r?"Testing ".concat(a.length," guardrail").concat(a.length>1?"s":"","..."):"Test ".concat(a.length," guardrail").concat(a.length>1?"s":"")})})]}),(0,n.jsx)(aC,{results:t,errors:i})]})]})},aO=e=>{let{guardrailsList:a,isLoading:l,accessToken:r,onClose:t}=e,[i,s]=(0,d.useState)(new Set),[o,c]=(0,d.useState)(""),[u,m]=(0,d.useState)([]),[x,h]=(0,d.useState)([]),[g,f]=(0,d.useState)(!1),j=a.filter(e=>{var a;return null===(a=e.guardrail_name)||void 0===a?void 0:a.toLowerCase().includes(o.toLowerCase())}),v=e=>{let a=new Set(i);a.has(e)?a.delete(e):a.add(e),s(a)},_=async e=>{if(0===i.size||!r)return;f(!0),m([]),h([]);let a=[],l=[];await Promise.all(Array.from(i).map(async t=>{let i=Date.now();try{let l=await (0,p.applyGuardrail)(r,t,e,null,null),s=Date.now()-i;a.push({guardrailName:t,response_text:l.response_text,latency:s})}catch(a){let e=Date.now()-i;console.error("Error testing guardrail ".concat(t,":"),a),l.push({guardrailName:t,error:a,latency:e})}})),m(a),h(l),f(!1),a.length>0&&er.Z.success("".concat(a.length," guardrail").concat(a.length>1?"s":""," applied successfully")),l.length>0&&er.Z.fromBackend("".concat(l.length," guardrail").concat(l.length>1?"s":""," failed"))};return(0,n.jsx)("div",{className:"w-full h-[calc(100vh-200px)]",children:(0,n.jsx)(as.Z,{className:"h-full",children:(0,n.jsxs)("div",{className:"flex h-full",children:[(0,n.jsxs)("div",{className:"w-1/4 border-r border-gray-200 flex flex-col overflow-hidden",children:[(0,n.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,n.jsxs)("div",{className:"mb-3",children:[(0,n.jsx)(ag.Z,{className:"text-lg font-semibold mb-3",children:"Guardrails"}),(0,n.jsx)(eg.Z,{icon:aj.Z,placeholder:"Search guardrails...",value:o,onValueChange:c})]})}),(0,n.jsx)("div",{className:"flex-1 overflow-auto",children:l?(0,n.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,n.jsx)(H.Z,{})}):0===j.length?(0,n.jsx)("div",{className:"p-4",children:(0,n.jsx)(eT.Z,{description:o?"No guardrails match your search":"No guardrails available"})}):(0,n.jsx)(af.Z,{dataSource:j,renderItem:e=>(0,n.jsx)(af.Z.Item,{onClick:()=>{e.guardrail_name&&v(e.guardrail_name)},className:"cursor-pointer hover:bg-gray-50 transition-colors px-4 ".concat(i.has(e.guardrail_name||"")?"bg-blue-50 border-l-4 border-l-blue-500":"border-l-4 border-l-transparent"),children:(0,n.jsx)(af.Z.Item.Meta,{avatar:(0,n.jsx)(T.Z,{checked:i.has(e.guardrail_name||""),onClick:a=>{a.stopPropagation(),e.guardrail_name&&v(e.guardrail_name)}}),title:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(av.Z,{className:"text-gray-400"}),(0,n.jsx)("span",{className:"font-medium text-gray-900",children:e.guardrail_name})]}),description:(0,n.jsxs)("div",{className:"text-xs space-y-1 mt-1",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Type: "}),(0,n.jsx)("span",{className:"text-gray-600",children:e.dheera_ai_params.guardrail})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Mode: "}),(0,n.jsx)("span",{className:"text-gray-600",children:e.dheera_ai_params.mode})]})]})})})})}),(0,n.jsx)("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:(0,n.jsxs)(an.Z,{className:"text-xs text-gray-600",children:[i.size," of ",j.length," selected"]})})]}),(0,n.jsxs)("div",{className:"w-3/4 flex flex-col bg-white",children:[(0,n.jsx)("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:(0,n.jsx)(ag.Z,{className:"text-xl font-semibold mb-0",children:"Guardrail Testing Playground"})}),(0,n.jsx)("div",{className:"flex-1 overflow-auto p-4",children:0===i.size?(0,n.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-gray-400",children:[(0,n.jsx)(av.Z,{style:{fontSize:"48px",marginBottom:"16px"}}),(0,n.jsx)(an.Z,{className:"text-lg font-medium text-gray-600 mb-2",children:"Select Guardrails to Test"}),(0,n.jsx)(an.Z,{className:"text-center text-gray-500 max-w-md",children:"Choose one or more guardrails from the left sidebar to start testing and comparing results."})]}):(0,n.jsx)("div",{className:"h-full",children:(0,n.jsx)(aP,{guardrailNames:Array.from(i),onSubmit:_,results:u.length>0?u:null,errors:x.length>0?x:null,isLoading:g,onClose:()=>s(new Set)})})})]})]})})})},aI=l(21609),aA=e=>{let{accessToken:a,userRole:l}=e,[r,t]=(0,d.useState)([]),[i,s]=(0,d.useState)(!1),[g,f]=(0,d.useState)(!1),[j,v]=(0,d.useState)(!1),[_,y]=(0,d.useState)(null),[b,N]=(0,d.useState)(!1),[w,k]=(0,d.useState)(null),[C,S]=(0,d.useState)(0),Z=!!l&&(0,ar.tY)(l),P=async()=>{if(a){f(!0);try{let e=await (0,p.getGuardrailsList)(a);console.log("guardrails: ".concat(JSON.stringify(e))),t(e.guardrails)}catch(e){console.error("Error fetching guardrails:",e)}finally{f(!1)}}};(0,d.useEffect)(()=>{P()},[a]);let O=async()=>{if(_&&a){v(!0);try{await (0,p.deleteGuardrailCall)(a,_.guardrail_id),er.Z.success('Guardrail "'.concat(_.guardrail_name,'" deleted successfully')),await P()}catch(e){console.error("Error deleting guardrail:",e),er.Z.fromBackend("Failed to delete guardrail")}finally{v(!1),N(!1),y(null)}}},I=_&&_.dheera_ai_params?A(_.dheera_ai_params.guardrail).displayName:void 0;return(0,n.jsx)("div",{className:"w-full mx-auto flex-auto overflow-y-auto m-8 p-2",children:(0,n.jsxs)(u.Z,{index:C,onIndexChange:S,children:[(0,n.jsxs)(m.Z,{className:"mb-4",children:[(0,n.jsx)(c.Z,{children:"Guardrails"}),(0,n.jsx)(c.Z,{disabled:!a||0===r.length,children:"Test Playground"})]}),(0,n.jsxs)(h.Z,{children:[(0,n.jsxs)(x.Z,{children:[(0,n.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,n.jsx)(o.Z,{onClick:()=>{w&&k(null),s(!0)},disabled:!a,children:"+ Add New Guardrail"})}),w?(0,n.jsx)(ap,{guardrailId:w,onClose:()=>k(null),accessToken:a,isAdmin:Z}):(0,n.jsx)(al,{guardrailsList:r,isLoading:g,onDeleteClick:(e,a)=>{y(r.find(a=>a.guardrail_id===e)||null),N(!0)},accessToken:a,onGuardrailUpdated:P,isAdmin:Z,onGuardrailClick:e=>k(e)}),(0,n.jsx)(eU,{visible:i,onClose:()=>{s(!1)},accessToken:a,onSuccess:()=>{P()}}),(0,n.jsx)(aI.Z,{isOpen:b,title:"Delete Guardrail",message:"Are you sure you want to delete guardrail: ".concat(null==_?void 0:_.guardrail_name,"? This action cannot be undone."),resourceInformationTitle:"Guardrail Information",resourceInformation:[{label:"Name",value:null==_?void 0:_.guardrail_name},{label:"ID",value:null==_?void 0:_.guardrail_id,code:!0},{label:"Provider",value:I},{label:"Mode",value:null==_?void 0:_.dheera_ai_params.mode},{label:"Default On",value:(null==_?void 0:_.dheera_ai_params.default_on)?"Yes":"No"}],onCancel:()=>{N(!1),y(null)},onOk:O,confirmLoading:j})]}),(0,n.jsx)(x.Z,{children:(0,n.jsx)(aO,{guardrailsList:r,isLoading:g,accessToken:a,onClose:()=>S(0)})})]})]})})}}}]);